import crypt

'''
1. read in passwd
2. parse to get username and password
3. parse dictionary
    - for each password create hash with salt (salt = "NaCl")
    - tie each hash to password
4. compare password hashes with user passwords for matches
'''
def parsePasswords(filename):
    print("[*] Generating Rainbow Table\n")
    parsed = {}
    passwordFile = open(filename, "r", errors="ignore")
    salt = "NaCl"
    
    for i in passwordFile.readlines():
        hashed = crypt.crypt(i.strip(), salt)
        parsed[i] = hashed

    passwordFile.close()
    return parsed

def main():
    passwd = open("passwd", "r")
    
    user_dict = {}
    
    print("[*] Reading in passwd file")
    for i in passwd.readlines():
        username = i.split(":")[0]
        password = i.split(":")[1]

        user_dict[username] = password
        
    passwd.close()

    rainbow = parsePasswords("../rockyou.txt")

    for i in user_dict:
        print("[*] Cracking Password for user: " + i)
        print("[*] Hash is: " + user_dict[i])
        flag = 0
        for j in rainbow:
            if rainbow[j] == user_dict[i]:
                print("[+] Password: " + j)
                flag = 1
                break
        if flag != 1:
            print("[-] No Pasword Found")
                

    return 1

if __name__ == "__main__":
    main()
